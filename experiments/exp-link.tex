% !Mode:: "TeX:DE:UTF-8:Main"

% GRRRRRR. Why do the validators report that the link is not tagged????
% Damn I forgot that objects must go in the parent tree too ...

\pdfvariable minorversion 7
\pdfvariable majorversion 1
\documentclass{article}

\usepackage{tagpdf}
\tagpdfsetup{
 activate-all,
 uncompress,
 tabsorder=structure,
 interwordspace=true,
 %show-spaces
 }
%metadata
\tagpdfsetup{add-new-tag = Link/Link}
\pdfextension catalog{/Lang (en-UK)}
\begin{document}
\tagstructbegin{tag=Document}
\leavevmode
\tagstructbegin{tag=P}
\tagmcbegin{tag=P}
abc
\tagmcend
\tagmcbegin{tag=P}
abc
\tagmcend
\tagstructbegin{tag=Link}
\tagmcbegin{tag=Link}
\ExplSyntaxOn
\int_gincr:N\g__uftag_abspage_int
\pdfextension startlink
    attr {/Border[0~0~1]}
    user{
        /Subtype/Link%
        /A<<%
         /Type/Action%
         /S/URI%
         /URI(http://www.dante.de)%
         /StructParent \int_use:n{\g__uftag_abspage_int}
         >>}
    This is a link.
\pdfextension endlink%

\seq_get:NNF
    \g__uftag_struct_stack_seq
    \l__uftag_struct_stack_parent_tmp_tl
    {
     \msg_error:nn { uftag } { struct-faulty-nesting }
    }
%doesn't work either    
%\__uftag_seq_gput_right:cx
%  { g__uftag_struct_kids_\l__uftag_struct_stack_parent_tmp_tl _seq }
%  {\pdffeedback lastlink \c_space_tl 0 \c_space_tl R}
      
\__uftag_struct_kid_link_gput_right:nn { \l__uftag_struct_stack_parent_tmp_tl }
 {\pdffeedback lastlink}

\ExplSyntaxOff
\tagmcend
\tagstructend
\tagstructend
\tagstructend
\end{document} 